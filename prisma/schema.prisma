// Configuration for SQLite (Development environment)
datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

// =========================================================
// USER & AUTHENTICATION
// =========================================================

// User model reflecting Clerk data
model User {
  id        String   @id // Matches Clerk User ID (e.g., user_2b3...)
  name      String
  email     String   @unique
  imageUrl  String?  // Optional: User profile picture from Clerk
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
   
  // Relation: User has a list of favorite movies (MyList)
  myList    MyList[]
  likes  Like[]
  dislikes Dislike[]
}

// =========================================================
// CONTENT MANAGEMENT (MOVIES & SHOWS)
// =========================================================

// Represents a Movie or a TV Show
model Movie {
  id           String   @id @default(uuid())
  title        String
  description  String
  
  // Media Assets
  thumbnailUrl String
  previewUrl   String?  // Short clip for hover preview
  videoUrl     String?  // Main video file (for movies)
  
  // Metadata
  duration     String
  rating       Float    // Requirements ask for "rating: number"
  releaseYear  Int
  
  // Relations
  tags         Tag[]    // Many-to-Many: Movies have multiple tags
  actors       Actor[]  // Many-to-Many: Movies have multiple actors
  episodes     Episode[] // One-to-Many: A TV Show has many episodes
  
  // Favorites
  favoritedBy  MyList[]
  likes     Like[]
  dislikes Dislike[]
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// Represents a single Episode of a TV Show
model Episode {
  id           String   @id @default(uuid())
  title        String
  description  String
  videoUrl     String
  thumbnailUrl String?
  duration     String
  
  // Relation: Belongs to one Movie (TV Show context)
  movieId      String
  movie        Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  
  createdAt    DateTime @default(now())
}

// Represents an Actor/Cast Member
model Actor {
  id        String   @id @default(uuid())
  fullName  String
  imageUrl  String?
  
  // Relation: Implicit Many-to-Many with Movie
  movies    Movie[] 
}

// Represents Categories/Genres (e.g., "Action", "Comedy")
model Tag {
  id      String   @id @default(uuid())
  name    String   @unique
  
  // Relation: Implicit Many-to-Many with Movie
  movies  Movie[]
}

// =========================================================
// INTERACTION (FAVORITES)
// =========================================================

// Join table for User Favorites
model MyList {
  id      String @id @default(uuid())
  userId  String
  movieId String

  createdAt DateTime @default(now())
   
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie   Movie  @relation(fields: [movieId], references: [id], onDelete: Cascade)

  // Ensures a user cannot favorite the same movie twice
  @@unique([userId, movieId])
}

model Like {
  id        String   @id @default(uuid())
  userId    String
  movieId   String
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@unique([userId, movieId]) // Garante que o usuário só pode dar 1 like por filme
}

model Dislike {
  id        String   @id @default(uuid())
  userId    String
  movieId   String
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@unique([userId, movieId])
}